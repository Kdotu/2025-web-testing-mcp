# MCP 웹페이지 테스트 시스템 고도화 작업 계획

**프로젝트 시작일**: 2025-07-29  
**1차 고도화 작업 시작일** : 2025-08-11  
**2차 고도화 작업 시작일** : 2025-08-18

**목표**: MCP를 활용한 웹사이트 테스트 시스템 고도화 및 확장  
**현재 상태**: 기본 시스템 구축 완료 (94%), 고도화 단계 진입 (Phase 10: 60% 완료, Phase 11: 0% 완료)  
**2차 고도화 완료 목표**: 2025년 9월 4일 (오늘 완료 예정)

### 🗓 2025-09-04 현행화 메모
- Phase 10 전반 진행률은 문서상 수치와 동일하게 유지되며, 새 완료 표기는 추가하지 않았습니다.
- 10.3(결과 다운로드), 10.4(Lighthouse), 10.5(타임아웃 정리), 10.6(프로세스 관리/코드 생성 품질)의 미완료 하위 작업들은 여전히 진행 중 또는 대기 상태입니다. 완료로 오표기하지 않았습니다.
- 오늘(2025-09-04) 데이터베이스 쿼리 타임아웃 문제(Code '57014') 발견 및 진단 완료, MCP 로깅 개선 및 테스트 상태/결과 조회 분리 작업 진행 중
- 오늘(2025-09-04) Playwright MCP 서버 사용자 코드 실행 문제 해결: scenarioCode 템플릿 주입 오류 수정, raw_data 저장 개선, TypeScript 에러 해결 완료
- 오늘(2025-09-04) 데이터베이스 테이블 통합 작업: m2_playwright_test_results를 m2_test_results로 통합하는 코드 수정 및 마이그레이션 가이드 작성 완료

## 📋 전체 개발 로드맵

### Phase 1-9: 기본 시스템 구축 ✅ 완료
- [x] **Phase 1**: 백엔드 인프라 구축
- [x] **Phase 2**: MCP 서버 연결
- [x] **Phase 3**: API 엔드포인트 구현
- [x] **Phase 4**: 프론트엔드 연동
- [x] **Phase 5**: 상세 메트릭 시스템
- [x] **Phase 6**: 문서화 기능
- [x] **Phase 7**: 배포 및 인프라
- [x] **Phase 8**: 테스트 결과 시각화
- [x] **Phase 9**: 실제 MCP 서버 기반 통합

### Phase 10: 핵심 기능 우선 구현 (8월 18일 ~ 9월 4일) - 18일 🔄 진행 중

#### **10.1 MCP 서버 문제 해결 및 단위테스트 시스템 구현 (8월 18일 ~ 9월 4일) - 18일** ✅ 완료
- [x] **10.1.1** k6 MCP 서버 문제 해결 (우선순위 1) - **완료**
  - [x] k6 MCP 서버 타임아웃 문제 진단 및 분석
  - [x] Child Process + stdin/stdout 방식의 한계점 파악
  - [x] k6 MCP 서버 실행 안정성 개선
  - [x] 타임아웃 오류 해결 및 프로세스 관리 최적화
  - [x] 프론트엔드 실행 연결: 기본 k6 스크립트 자동 생성으로 400(Bad Request) 오류 해결 (script 필드 필수 필드 충족)

- [x] **10.1.2** Playwright MCP 서버 문제 해결 (우선순위 2) - **완료**
  - [x] Playwright MCP 서버 연결 문제 진단 및 분석
  - [x] 연결 및 실행 로직 문제 해결
  - [x] MCP 서버와 직접 실행 방식 병행 지원 구현
  - [x] E2E 테스트 완료 처리 문제 해결 완료
  - [x] 사용자 시나리오 코드 실행 문제 해결 (scenarioCode 템플릿 주입 오류 수정)
  - [x] raw_data 저장 개선 (MCP 로그 및 상세 결과 포함)
  - [x] TypeScript 에러 해결 (PlaywrightTestResult 인터페이스 개선)

- [x] **10.1.3** Playwright 기반 단위테스트 엔진 구축 - **완료**
  - [x] 웹페이지 입력값 기반 테스트 시나리오 생성 시스템 (설정 모드 2가지 버전 구현)
  - [x] 단위테스트 결과 데이터 구조 설계 및 DB 스키마 구현
  - [x] 테스트 실행 결과 DB 저장 및 조회 API 구현
  - [x] 시나리오 입력 모드와 백엔드 연동 완성 (사용자 코드 실행 문제 해결)

- [x] **10.1.4** raw_data 저장 문제 해결 (우선순위 3) - **완료**
  - [x] TestResultService.updateResult 메서드 수정으로 메트릭 데이터 보존
  - [x] Playwright 테스트 결과에 raw_data 저장 개선 (MCP 로그 및 상세 결과 포함)
  - [x] 데이터베이스 스키마 개선 (m2_playwright_test_results 테이블에 raw_data 컬럼 추가)
  - [x] MCP 결과에서 상세 로그 추출 및 저장 로직 구현
  - [ ] k6 메트릭 파싱 및 저장 로직 검증 (추가 개선 필요)
  - [ ] 테스트 결과 데이터 무결성 검증 시스템 구현 (추가 개선 필요)

#### **10.2 테스트 설정 관리 페이지 구현 및 배포 최적화 () - 4일**
- [ ] **10.2.1** 테스트 설정 관리 UI 레이아웃 설계
  - [ ] 설정 메뉴에 테스트 설정 관리 페이지 추가
  - [ ] 테스트 설정 div 레이아웃 및 구조 설계
  - [ ] 반응형 디자인 및 사용자 경험 최적화
  - [ ] 설정 카테고리별 그룹화 및 정렬

- [ ] **10.2.2** 테스트 설정 요소 관리 시스템
  - [ ] 테스트에 지정할 요소명 입력 및 관리
  - [ ] 카테고리 선택 및 분류 시스템
  - [ ] 설정 우선순위 및 중요도 관리
  - [ ] 설정 검색 및 필터링 기능

- [ ] **10.2.3** 백엔드 설정 관리 API 구현
  - [ ] 테스트 설정 CRUD API 엔드포인트
  - [ ] 설정 데이터베이스 스키마 설계
  - [ ] 설정 검증 및 유효성 검사 로직
  - [ ] 설정 버전 관리 및 히스토리 추적

- [ ] **10.2.4** 배포 용량 최적화
  - [ ] MCP 서버 의존성 정리 및 불필요한 패키지 제거
  - [ ] 빌드 파일 및 임시 파일 정리
  - [ ] 경량화된 MCP 서버 구현

#### **10.3 테스트 결과 다운로드 기능 구현 () - 1일**
- [ ] **10.3.1** HTML 리포트 다운로드 시스템 개선
  - [ ] 테스트 결과 HTML 템플릿 개선 및 모던 디자인 적용
  - [ ] 반응형 레이아웃 및 기본 차트 시각화
  - [ ] 로컬 환경 다운로드 문제 해결

- [ ] **10.3.2** PDF 리포트 다운로드 시스템 개선
  - [ ] HTML을 PDF로 변환하는 기능 개선
  - [ ] PDF 템플릿 디자인 및 스타일링 개선
  - [ ] 로컬 환경 다운로드 문제 해결

#### **10.4 Lighthouse MCP 서버 문제 해결 () - 1일**
#### **10.1.5 실행 환경/데이터 이슈 대응 () - 2일**
- [ ] k6 부하 테스트 실행 불가(ENOENT) 환경 점검 및 대응 계획 수립
- [ ] Lighthouse 테스트 중복 row 삽입 원인 분석 및 저장 정책 수립
- [ ] **10.4.1** Lighthouse MCP 서버 실행 오류 분석 및 수정 - **진행 중**
  - [x] CLI 실행은 되지만 실제 테스트 실행 시 오류 발생 문제 진단
  - [x] Child Process + stdin/stdout 방식의 한계점 분석
  - [ ] Lighthouse MCP 서버 실행 안정성 개선
  - [ ] 테스트 실행 오류 해결 및 결과 파싱 개선

#### **10.5 백엔드 재시작 시 테스트 타임아웃 문제 해결 (8월 29일 ~ 9월 3일) - 5일** 🔄 진행 중
- [ ] **10.5.1** Lighthouse 테스트 타임아웃 문제 진단 및 분석 - **진행 중**
  - [x] 백엔드 재시작 시 1096분(18시간+) 실행 중인 테스트 발견
  - [x] 10분 타임아웃 임계값 초과 문제 파악
  - [ ] 타임아웃된 테스트 프로세스 자동 정리 시스템 구현
  - [ ] 데이터베이스 상태 불일치 문제 해결

- [ ] **10.5.2** 테스트 프로세스 관리 시스템 개선
  - [ ] 테스트 실행 상태 모니터링 및 자동 정리 로직 구현
  - [ ] 서버 재시작 시 고아 프로세스 정리 메커니즘 추가
  - [ ] 타임아웃 설정 동적 조정 및 관리 시스템 구축
  - [ ] 테스트 실행 히스토리 및 로그 관리 개선

- [ ] **10.5.3** 시스템 안정성 및 복구 메커니즘 강화
  - [ ] 백엔드 서버 재시작 시 테스트 상태 일관성 보장
  - [ ] 장시간 실행 중인 테스트 자동 감지 및 정리
  - [ ] 시스템 리소스 모니터링 및 관리 개선
  - [ ] 테스트 실행 실패 시 자동 복구 로직 구현

#### **10.6 MCP 프로세스 관리 및 코드 생성 품질 개선 (8월 29일 ~ 9월 3일) - 5일** 🔄 진행 중
- [ ] **10.6.1** MCP 프로세스 관리 시스템 안정화 - **진행 중**
  - [x] MCP 프로세스 ID 불일치 문제 발견
  - [x] 프로세스 손실 시 "Process not found" 오류 발생 확인
  - [ ] 프로세스 ID 동기화 메커니즘 구현
  - [ ] 프로세스 손실 시 자동 재생성 로직 추가

- [ ] **10.6.2** Playwright 코드 생성기 품질 개선 - **진행 중**
  - [x] 생성된 코드의 문법 오류 발견 (괄호 중복, $ 중복, 공백 오류)
  - [ ] 코드 템플릿 문법 검증 및 수정 로직 구현
  - [ ] 자동 코드 품질 검사 시스템 구축
  - [ ] 코드 생성 실패 시 폴백 메커니즘 구현

- [ ] **10.6.3** 테스트 타입 ID 및 데이터베이스 일관성 문제 해결
  - [x] Playwright 테스트 타입 ID null 반환 문제 발견
  - [ ] 데이터베이스 스키마와 코드 간 일치성 확인
  - [ ] 테스트 타입 매핑 로직 수정 및 검증
  - [ ] 데이터베이스 상태 일관성 검증 시스템 구현

#### **10.6.4** 테스트 시나리오 작성 UI 워크플로우 개선 (8월 29일 ~ 9월 3일) - 5일** 🔄 진행 중
- [x] **10.6.4.1** 단계별 검증 워크플로우 구현 - **완료**
  - [x] 자연어 입력 → 코드 검증 → 자연어 변환 → 테스트 실행 순서 정의
  - [x] 각 단계별 완료 상태 추적 시스템 구현
  - [x] 버튼 활성화/비활성화 조건 설정
  - [x] 진행 상황 시각적 표시 구현

- [x] **10.6.4.2** 코드 검증 시스템 구현 - **완료**
  - [x] Playwright 코드 문법 검사 로직 구현
  - [x] 실행 가능 여부 확인 및 오류 검출 (console.log 포함 유연한 검증)
  - [x] 오류 내용 및 수정 제안 시스템 구축
  - [x] 검증 결과 시각적 피드백 제공

- [x] **10.6.4.3** 자연어 변환 처리 및 MCP 서버 연동 - **완료**
  - [x] MCP 서버로 전송할 스크립트 사전 점검 로직 구현
  - [x] 변환 결과 검증 및 품질 확인
  - [x] 최종 실행 코드 생성 및 검증
  - [x] 변환 실패 시 수동 편집 모드 제공

- [x] **10.6.4.4** 테스트 실행 제어 시스템 구현 - **완료**
  - [x] 모든 검증 완료 후에만 테스트 실행 가능하도록 제어
  - [x] 하단 "테스트 시작" 버튼으로 최종 실행 제어 (중복 버튼 제거)
  - [x] 실행 전 최종 확인 및 상태 표시
  - [x] 실행 결과 및 오류 피드백 시스템 구축

### Phase 11: 부가 기능 및 시스템 안정화 (9월 4일) - 1일 ❌ 대기 중

#### **11.1 MCP 서버 연결 방식 개선 (9월 4일) - 1일**
- [ ] **11.1.1** Playwright MCP 서버 연결 방식 개선
  - [ ] 현재 JSON 기반 stdin/stdout 방식 검토
  - [ ] 실제 @playwright/mcp 패키지 기반 연결 방식으로 변경
  - [ ] Playwright MCP 서버 정상 실행 확인

- [ ] **11.1.2** Lighthouse MCP 서버 연결 방식 개선 - **대기 중**
  - [ ] 현재 연결 방식 검토
  - [ ] 실제 lighthouse-mcp 패키지 기반 연결 방식으로 변경
  - [ ] Lighthouse MCP 서버 정상 실행 확인

#### **11.2 시스템 안정화 및 최적화 (9월 4일) - 1일**
- [ ] **11.2.1** MCP 서버 실행 환경 최적화
  - [ ] 현재 Child Process + stdin/stdout 방식의 한계점 분석
  - [ ] MCP 서버 프로세스 관리 및 리소스 정리 로직 개선
  - [ ] MCP 서버 실행 시 메모리 누수 방지
  - [ ] 동시 실행 시 프로세스 충돌 방지 로직 구현

- [ ] **11.2.2** 에러 핸들링 및 로깅 시스템 강화
  - [ ] MCP 서버 연결 실패 시 재시도 메커니즘 구현
  - [ ] 상세한 에러 로그 및 디버깅 정보 제공
  - [ ] 사용자 친화적인 에러 메시지 표시
  - [ ] 에러 발생 시 자동 복구 로직 구현

- [ ] **11.2.3** 테스트 검증 및 상태 관리 시스템 보완
  - [ ] 테스트 실행 상태 검증 로직 구현
  - [ ] 테스트 실행 화면 상태 업데이트 개선
  - [ ] 테스트 결과 검증 및 일관성 보장
  - [ ] 오프라인 표기 규칙: 오프라인 모드에서는 '연결' 대신 '오프라인' 표시 (UI/상태 일관성)

## 🎯 **조정된 고도화 작업 우선순위 및 일정**

### **1단계 (8월 18일 ~ 8월 31일): 핵심 기능 구현** 🔄 진행 중
- **Phase 10**: MCP 서버 문제 해결 + 핵심 기능 구현 - **25% 완료**

### **2단계 (9월 4일): 시스템 안정화** ❌ 대기 중
- **Phase 11**: MCP 서버 개선 및 시스템 안정화 - **0% 완료**

## 📊 **조정된 완료 일정**

- **Phase 10**: 8월 18일 ~ 8월 31일 (14일) - **MCP 서버 문제 해결 + 핵심 기능 구현** 🔄 **진행 중**
- **Phase 11**: 9월 4일 (1일) - **시스템 안정화 및 최적화** ❌ **대기 중**

**전체 2차 고도화 작업 완성**: **2025년 9월 4일**

## ✅ **이미 구현 완료된 요소들**

### **테스트 타입 잠금 시스템 (100% 완료)**
- [x] 데이터베이스 스키마: `is_locked`, `locked_by`, `lock_type` 컬럼 추가
- [x] 백엔드 서비스: `TestTypeService`에 잠금/해제 로직 구현
- [x] 프론트엔드 UI: Settings.tsx에 잠금 상태 토글 기능 구현
- [x] 모든 테스트 서비스에 잠금 시스템 통합 (Lighthouse, k6, E2E)

### **MCP 서버 기본 구현 (100% 완료)**
- [x] **Lighthouse MCP 서버**: CLI 실행 로직 개선, Windows 환경 대응, 백엔드 연동 완료
- [x] **k6 MCP 서버**: Python 기반 서버 구현, 백엔드 연동 완료
- [x] **Playwright MCP 서버**: Node.js 기반 서버 구현, 백엔드 연동 완료

### **테스트 타입 통일 (100% 완료)**
- [x] 'e2e' → 'playwright' ID 변경 완료
- [x] 데이터베이스 마이그레이션 파일 업데이트 완료
- [x] 모든 서비스에서 일관된 테스트 타입 ID 사용

### **기본 테스트 결과 다운로드 (60% 완료)**
- [x] HTML 리포트 생성 및 다운로드 기능 구현
- [x] PDF 리포트 생성 및 다운로드 기능 구현
- [x] 다운로드 UI 및 API 엔드포인트 구현
- ⚠️ 로컬 환경에서 다운로드 문제 일부 존재 (Phase 10.3에서 해결 예정)

## 🚀 **기대 효과**

### **핵심 기능 구현 효과**
- **단위테스트 시스템**: 웹페이지 입력값 기반 자동화된 테스트 실행
- **테스트 설정 관리**: 체계적인 테스트 설정 관리 및 버전 제어
- **결과 다운로드**: HTML/PDF 형태의 전문적인 테스트 리포트 제공

### **사용자 경험 개선**
- 직관적이고 사용하기 쉬운 테스트 설정 관리
- 자동화된 단위테스트 실행 및 결과 분석
- 전문적인 테스트 리포트 생성 및 다운로드

### **운영 효율성 향상**
- 체계적인 테스트 설정 관리 및 버전 제어
- 자동화된 테스트 실행 및 결과 수집
- 확장 가능한 MCP 서버 아키텍처

## 📝 **현재 개발 상태**

**현재 단계**: Phase 10.1 완료, Phase 10.2 진행 중 - 테스트 설정 관리 페이지 구현, 데이터베이스 테이블 통합 검토 완료  
**최근 작업**: 
1. ✅ **k6 MCP 서버 문제 해결 완료** (Phase 10.1.1) - 타임아웃, 인코딩, 출력 형식 문제 모두 해결
2. ✅ **Playwright MCP 서버 문제 해결 완료** (Phase 10.1.2) - E2E 테스트 완료 처리 문제 해결, 사용자 코드 실행 문제 해결
3. ✅ **Playwright 기반 단위테스트 엔진 구축 완료** (Phase 10.1.3) - 설정 모드 2가지 버전 구현, 백엔드 연동 완성
4. ✅ **raw_data 저장 문제 해결 완료** (Phase 10.1.4) - Playwright 테스트 결과 저장 개선, MCP 로그 포함, DB 스키마 개선
5. 🔄 **테스트 설정 관리 페이지 구현 진행 중** (Phase 10.2) - UI 레이아웃 완료, 요소 관리 및 API 구현 중
6. 🔄 **테스트 결과 다운로드 기능 구현 진행 중** (Phase 10.3) - HTML 리포트 완료, PDF 리포트 및 로컬 다운로드 문제 해결 중
7. 🔄 **Lighthouse MCP 서버 문제 해결 진행 중** (Phase 10.4) - 문제 진단 완료, 실행 안정성 개선 및 오류 해결 중
8. 🔄 **데이터베이스 쿼리 타임아웃 문제 해결 진행 중** (2025-09-04) - Code '57014' 오류 진단 완료, MCP 로깅 개선 및 테스트 상태/결과 조회 분리 작업 진행 중
9. ✅ **데이터베이스 테이블 통합 작업 완료** (2025-09-04) - m2_playwright_test_results를 m2_test_results로 통합하는 코드 수정 및 마이그레이션 가이드 작성 완료

**다음 작업**: 
1. ✅ **단위테스트 시나리오 실행 기능 완성** (Phase 10.1.3 완료) - 시나리오 입력 모드와 백엔드 연동 완성
2. ✅ **raw_data 저장 문제 해결 완료** (Phase 10.1.4 완료) - Playwright 테스트 결과 저장 개선
3. 🔄 **테스트 설정 관리 시스템 완성** (Phase 10.2 진행 중) - UI 레이아웃 완료, 요소 관리 및 API 구현 필요
4. 🔄 **테스트 결과 다운로드 기능 완성** (Phase 10.3 진행 중) - HTML 리포트 완료, PDF 리포트 개선 필요
5. 🔄 **Lighthouse MCP 서버 문제 해결 완료** (Phase 10.4 진행 중) - 실행 안정성 개선 필요
6. 🔄 **데이터베이스 쿼리 타임아웃 문제 해결** (2025-09-04) - Code '57014' 오류 해결 필요
7. ✅ **데이터베이스 테이블 통합 작업 완료** (2025-09-04) - 코드 수정 및 마이그레이션 가이드 작성 완료
8. **Phase 11 시작**: MCP 서버 연결 방식 개선

**향후 계획**: 9월 4일까지 Phase 10의 핵심 기능 구현을 완료하고, Phase 11의 시스템 안정화 작업을 통해 안정적이고 확장 가능한 MCP 시스템 구축 완료. 단위테스트 시나리오 작성 내용을 기준으로 실행되도록 하는 기능은 이미 완성되었으며, 현재 테스트 설정 관리 시스템과 결과 다운로드 기능 개선에 집중

## 📝 개발 노트

### **2025-09-04: Playwright MCP 서버 사용자 코드 실행 문제 해결**

**해결된 주요 문제점**
- ✅ **scenarioCode 템플릿 주입 오류**: MCP 서버에서 사용자 코드가 템플릿 리터럴에 제대로 삽입되지 않던 문제 해결
- ✅ **raw_data 저장 개선**: Playwright 테스트 결과에 MCP 로그 및 상세 결과를 포함하여 저장
- ✅ **TypeScript 에러 해결**: PlaywrightTestResult 인터페이스에 data 속성 추가 및 타입 안정성 개선
- ✅ **데이터베이스 스키마 개선**: m2_playwright_test_results 테이블에 raw_data 컬럼 추가

**구현된 개선사항**
- 사용자가 작성한 Playwright 시나리오 코드가 실제로 실행되도록 수정
- MCP 서버에서 반환되는 상세한 로그가 raw_data에 저장되도록 개선
- 테스트 상태 조회와 결과 조회를 분리하여 성능 최적화
- 데이터베이스 쿼리 타임아웃 문제 진단 및 해결 방안 수립

**현재 상태**
- Phase 10.1 완료: MCP 서버 문제 해결 및 단위테스트 시스템 구현 완료
- Phase 10.2 진행 중: 테스트 설정 관리 페이지 구현
- 데이터베이스 테이블 통합 작업 완료: m2_playwright_test_results → m2_test_results 통합 코드 수정 및 마이그레이션 가이드 작성
- 전체 진행률: Phase 10 기준 약 60% 완료

### **2025-08-29: 프론트엔드 검증/워크플로우 현행화 업데이트**

**반영된 개선사항**
- 자연어 변환 중 입력창 비활성화: 변환 버튼 클릭 시 `textarea`가 `disabled` 처리되고, 완료/실패 시 자동 복원
- "1단계부터 다시 시작" 개선: 재시작 시 바로 MCP 점검을 재실행하여 `mcp_check` 단계를 즉시 완료 상태로 복구
- 코드 정리(sanitize) 정책 단순화: 불필요한 변환으로 오류 유입 방지를 위해 현재는 원본 코드 그대로 사용
- 코드 검증 기준 완화(정규식 기반):
  - `chromium.launch(` 존재 (`/chromium\s*\.\s*launch\s*\(/`)
  - `browser.newPage(` 또는 `page = await browser.newPage(` 존재
    (`/(browser\s*\.\s*newPage\s*\(|page\s*=\s*await\s*browser\s*\.\s*newPage\s*\()/`)
  - `console.log(` 존재 (`/console\.log\s*\(/`)
  - 괄호/따옴표 균형, 최소 길이(50자) 검사 유지
- 검증 실패 시 다음 단계 차단 로직 강화: 4단계 실패 시 5단계는 자동으로 실패/차단 처리

**진행 상태 반영**
- 10.6.4 사용자 워크플로우 개선 세부 항목 추가 완료
  - [x] 자연어 변환 중 입력 차단/복구
  - [x] 재시작 시 MCP 점검 자동 재확인
  - [x] 검증 기준 정규식 완화 및 구조적 정상성 우선
  - [x] 검증 실패 시 다음 단계 차단 및 안내 문구 표기

### **2025-08-28: 일정 재조정 및 이슈 정리**

#### **📅 일정 조정**
- 오늘(2025-08-28) 기준 기능 구현 진척이 없어 Phase 10/11 전체 일정을 3일 순연
- Phase 10: 8월 18일 ~ 9월 3일, Phase 11: 9월 4일로 조정

#### **🚨 미해결 이슈 정리**
1. 부하 테스트 실행 불가 문제: k6 실행 시 ENOENT 발생 (Windows PATH/설치/권한 이슈 의심)
2. Lighthouse 테스트 실행 시 동일 테스트 row가 중복 삽입되는 문제

#### **🛠 즉시 점검 태스크(계획만)**
- [ ] k6 프로세스 경로/설치/실행 권한 점검 계획 수립 및 체크리스트 반영
- [ ] 백엔드 k6 실행 경로 해석 방식 검토(절대경로/확장자 .exe, 쉘 사용 여부)
- [ ] Lighthouse 저장 로직 확인(UPSERT/트랜잭션/중복 키 제약/멱등성 키) 설계안 수립
- [ ] 두 이슈 재현 시나리오 정의 및 로그 수집 포인트 확정

### **2025-08-25: Phase 10 진행 상황 재점검**

#### **🔧 주요 작업 내용**

**1. Phase 10 진행 상황 재점검**
- ✅ **10.1.1**: k6 MCP 서버 문제 해결 - **100% 완료**
- ✅ **10.1.2**: Playwright MCP 서버 문제 해결 - **100% 완료**
- ✅ **10.1.3**: Playwright 기반 단위테스트 엔진 구축 - **100% 완료**
- 🔄 **10.1.4**: raw_data 저장 문제 해결 - **25% 완료** (TestResultService.updateResult 메서드 수정만 완료)
- 🔄 **10.2**: 테스트 설정 관리 페이지 구현 - **40% 완료** (UI 레이아웃만 완료)
- 🔄 **10.3**: 테스트 결과 다운로드 기능 구현 - **60% 완료** (HTML 리포트만 완료)
- 🔄 **10.4**: Lighthouse MCP 서버 문제 해결 - **50% 완료** (문제 진단만 완료)

**2. 실제 구현 상태 확인 결과**
- ❌ **raw_data 저장 문제**: 메트릭 및 요약 데이터가 빈 객체로 저장되는 문제 아직 완전 해결되지 않음
- ❌ **테스트 설정 관리**: UI 레이아웃만 구현되고 실제 설정 요소 관리 시스템 미완성
- ❌ **테스트 결과 다운로드**: HTML 리포트만 완성되고 PDF 리포트 및 로컬 다운로드 문제 미해결
- ❌ **Lighthouse MCP 서버**: 문제 진단만 완료되고 실제 실행 안정성 개선 및 오류 해결 미완성

#### **🎯 해결해야 할 문제점**

1. **raw_data 저장 문제**: 데이터베이스 스키마 불일치, k6 메트릭 파싱 검증, 데이터 무결성 검증 시스템 구현 필요
2. **테스트 설정 관리**: 카테고리 선택/분류, 우선순위/중요도 관리, 검색/필터링 기능 구현 필요
3. **테스트 결과 다운로드**: PDF 템플릿 개선, 로컬 환경 다운로드 문제 해결 필요
4. **Lighthouse MCP 서버**: 실행 안정성 개선, 테스트 실행 오류 해결, 결과 파싱 개선 필요

#### **📊 현재 진행상황**

- **Phase 10**: **35% 완료** 🔄 - 핵심 기능 구현 진행 중
- **Phase 11**: **0% 완료** ❌ - 아직 시작하지 않음
- **전체 진행률**: **67.5% 완료** (Phase 1-9 완료 + Phase 10 35% 완료)

#### **🔍 다음 작업**

- Phase 10.1.4: raw_data 저장 문제 해결 완료 (데이터베이스 스키마, 메트릭 파싱, 무결성 검증)
- Phase 10.2: 테스트 설정 관리 시스템 완성 (요소 관리, API 구현, 검증 로직)
- Phase 10.3: 테스트 결과 다운로드 기능 완성 (PDF 리포트, 로컬 다운로드 문제 해결)
- Phase 10.4: Lighthouse MCP 서버 문제 해결 완료 (실행 안정성, 오류 해결)

### **2025-08-11: 테스트 타입 관리 시스템 개선**

#### **🔧 주요 작업 내용**

**1. 테스트 타입 관리 시스템 개선**
- [x] **데모 모드와 일반 모드 분리**
  - 데모 모드: 기본 제공 테스트 타입만 표시
  - 일반 모드: 사용자 정의 테스트 타입만 표시
  - 오프라인 모드: 기본 테스트 타입 표시

- [x] **불필요한 설정 제거**
  - 하드코딩된 카테고리 우선순위 설정 제거
  - DB 데이터 중심의 단순한 정렬 로직 적용

**2. 컴포넌트 수정**
- [x] **`Settings.tsx`**: 모드별 테스트 타입 필터링 로직 개선
- [x] **`TestExecution.tsx`**: 테스트 타입 불러오기 시 모드별 필터링 적용
- [x] **`api.tsx`**: 데모 모드와 일반 모드에 따른 데이터 반환 로직 분리

**3. 빌드 설정 최적화**
- [x] **`tsconfig.json`**: `baseUrl` 추가로 절대 경로 import 지원

#### **🎯 해결된 문제점**

1. **테스트 타입 관리 혼란 해결** - 사용자가 요청하지 않은 카테고리 우선순위 설정 제거
2. **모드별 데이터 표시 개선** - 데모/일반/오프라인 모드에 따른 적절한 테스트 타입 표시
3. **코드 품질 향상** - 불필요한 하드코딩 제거 및 DB 데이터 중심 구조로 개선

#### **📊 현재 진행상황**

- **Phase 10.1 시작**: MCP 서버 문제 해결 및 단위테스트 시스템 구현 준비
- **전체 진행률**: Phase 10 기준 약 15% 완료 (이미 완료된 요소들 포함)

#### **🔍 다음 작업**

- Phase 10.1.1: k6 MCP 서버 타임아웃 문제 해결 (우선순위 1)
- Phase 10.1.2: Playwright MCP 서버 연결 문제 해결 (우선순위 2)
- Phase 10.1.3: Playwright 기반 단위테스트 엔진 구축

### **2025-08-18: 2차 고도화 작업 시작 및 우선순위 조정**

#### **🔧 주요 작업 내용**

**1. 우선순위 재조정**
- **핵심 기능 우선**: 단위테스트 + 테스트 설정 관리 + 결과 다운로드
- **부가 기능 후순위**: MCP 서버 개선 + 시스템 안정화
- **일정 단축**: 8월 25일까지 완료 목표

**2. 이미 구현 완료된 요소들 정리**
- ✅ **테스트 타입 잠금 시스템**: 100% 완료
- ✅ **MCP 서버 기본 구현**: 100% 완료 (Lighthouse, k6, Playwright)
- ✅ **테스트 타입 통일**: 100% 완료 ('e2e' → 'playwright')
- ✅ **기본 테스트 결과 다운로드**: 80% 완료

**3. 새로운 개발 계획**
- **Phase 10**: MCP 서버 문제 해결 + 핵심 기능 우선 구현 (6일)
- **Phase 11**: 부가 기능 및 시스템 안정화 (2일)

#### **🎯 해결된 문제점**

1. **테스트 타입 관리 혼란 해결** - 'e2e'와 'playwright' ID 통일
2. **MCP 서버 기본 기능 완성** - Lighthouse, k6, Playwright 모두 정상 작동
3. **테스트 타입 보호 시스템 완성** - 잠금/해제 기능으로 설정 변경 방지

#### **📊 현재 진행상황**

- **Phase 10.1 시작**: MCP 서버 문제 해결 및 단위테스트 시스템 구현 준비
- **전체 진행률**: Phase 10 기준 약 15% 완료 (이미 완료된 요소들 포함)

#### **🔍 다음 작업**

- Phase 10.1.1: k6 MCP 서버 타임아웃 문제 해결 (우선순위 1)
- Phase 10.1.2: Playwright MCP 서버 연결 문제 해결 (우선순위 2)
- Phase 10.1.3: Playwright 기반 단위테스트 엔진 구축

### **2025-08-19: 백엔드 리팩토링 완료 및 UI 컴포넌트 통합**

#### **🔧 주요 작업 내용**

**1. 백엔드 아키텍처 리팩토링 완료**
- ✅ **TestManageController 통합**: E2E, Lighthouse, Load 테스트 컨트롤러를 하나로 통합
- ✅ **TestManageService 생성**: 공통 테스트 상태 관리 로직을 서비스 레이어로 분리
- ✅ **라우트 통합**: 모든 테스트 실행 라우트를 `/api/test`로 통합, 상태 관리 라우트를 `/api/test-manage`로 분리
- ✅ **기존 컨트롤러 제거**: `e2e-test-controller.ts`, `lighthouse-controller.ts`, `load-test-controller.ts` 삭제
- ✅ **기존 라우트 제거**: `e2e-tests.ts`, `lighthouse-tests.ts`, `load-tests.ts` 삭제

**2. 프론트엔드 API 연동 업데이트**
- ✅ **backend-api.ts 수정**: 새로운 통합 API 엔드포인트에 맞춰 모든 테스트 관련 함수 업데이트
- ✅ **HTTP 메서드 수정**: 테스트 취소 시 `DELETE` 메서드 사용으로 404 오류 해결
- ✅ **테스트 타입 매핑**: E2E, Lighthouse, Load 테스트 타입별 올바른 API 호출 구현

**3. UI 컴포넌트 통합 및 재사용성 향상**
- ✅ **DemoModeNotice 컴포넌트**: 공통 데모 모드 알림 컴포넌트 생성
- ✅ **TestResultHeader 컴포넌트**: 테스트 결과 페이지 헤더 컴포넌트 생성
- ✅ **SettingsHeader 컴포넌트**: 테스트 설정 페이지 헤더 컴포넌트 생성
- ✅ **DashboardHeader 컴포넌트**: 대시보드 페이지 헤더 컴포넌트 생성 (연결 상태 배너 포함)
- ✅ **컴포넌트 통합**: 모든 페이지에서 일관된 헤더와 상태 배너 사용

**4. 테스트 실행 및 중단 플로우 개선**
- ✅ **테스트 중단 모달**: 중단 버튼 클릭 시 확인 모달 표시 후 실제 중단 실행
- ✅ **상태 관리 개선**: 테스트 상태 변경 시 일관된 데이터베이스 업데이트
- ✅ **에러 처리 강화**: MCP 서버 실패 시 적절한 에러 메시지 표시

#### **🎯 해결된 문제점**

1. ✅ **백엔드 아키텍처 복잡성**: 개별 컨트롤러/라우트 구조를 통합 구조로 단순화
2. ✅ **코드 중복**: 공통 테스트 상태 관리 로직을 `TestManageService`로 통합
3. ✅ **API 엔드포인트 혼란**: 테스트 실행과 상태 관리를 명확히 분리된 엔드포인트로 정리
4. ✅ **UI 일관성**: 모든 페이지에서 동일한 디자인과 사용자 경험 제공
5. ✅ **테스트 중단 404 오류**: 올바른 HTTP 메서드와 엔드포인트 사용으로 해결

#### **📊 현재 진행상황**

- **Phase 10.1.1**: k6 MCP 서버 문제 해결 - **100% 완료** ✅
- **Phase 10.1.2**: Playwright MCP 서버 문제 해결 - **80% 완료** 🔄
- **Phase 10.1.3**: Playwright 기반 단위테스트 엔진 구축 - **60% 완료** 🔄
- **백엔드 리팩토링**: **100% 완료** ✅
- **UI 컴포넌트 통합**: **100% 완료** ✅
- **전체 진행률**: Phase 10 기준 약 50% 완료

#### **🔍 다음 작업**

1. **Playwright MCP 서버 E2E 테스트 완료 처리 문제 해결** (Phase 10.1.2 완료)
2. **Playwright 기반 단위테스트 엔진 완성** (Phase 10.1.3 완료)
3. **테스트 설정 관리 페이지 구현** (Phase 10.2 시작)
4. **배포 용량 최적화** (Phase 10.2.4)

### **2025-08-19: raw_data 저장 문제 발견 및 진단**

#### **🚨 발견된 주요 문제점**

**1. raw_data 저장 문제**
- ❌ **metrics**: 빈 객체 `{}`로 저장되어 실제 테스트 메트릭 데이터 누락
- ❌ **summary**: 빈 객체 `{}`로 저장되어 테스트 요약 정보 누락
- ❌ **details**: 빈 객체 `{}`로 저장되어 상세 테스트 결과 누락
- ❌ **config**: 빈 객체 `{}`로 저장되어 테스트 설정 정보 누락
- ✅ **raw_data**: 정상적으로 저장되어 k6 출력 로그는 보존

**2. 문제 원인 분석**
- ❌ **TestResultService.updateResult**: 메트릭 및 요약 데이터 업데이트 시 빈 객체로 덮어쓰기
- ❌ **데이터베이스 스키마 불일치**: 프론트엔드와 백엔드 간 데이터 구조 차이
- ❌ **k6 출력 파싱**: 메트릭 추출 로직은 정상이지만 DB 저장 시 데이터 손실

#### **🔧 문제 해결 방안**

**1. 즉시 해결해야 할 문제 (Phase 10.1.4 추가)**
- **TestResultService 수정**: `updateResult` 메서드에서 기존 데이터 보존 로직 구현
- **데이터 구조 일치**: 프론트엔드와 백엔드 간 메트릭/요약 데이터 구조 통일
- **k6 메트릭 저장**: 파싱된 메트릭 데이터가 실제로 DB에 저장되도록 수정

**2. 장기적 해결 방안**
- **데이터 검증 시스템**: 테스트 결과 저장 시 데이터 무결성 검증
- **백업 및 복구**: 메트릭 데이터 손실 시 자동 복구 메커니즘
- **모니터링**: 데이터 저장 실패 시 즉시 알림 시스템

#### **🎯 우선순위 조정**

**Phase 10.1.4 추가**: raw_data 저장 문제 해결 (8월 19일 ~ 8월 20일) - **1일**
- **기존 Phase 10.1.2**: Playwright MCP 서버 문제 해결 - **80% 완료** 🔄
- **기존 Phase 10.1.3**: Playwright 기반 단위테스트 엔진 구축 - **60% 완료** 🔄
- **새로 추가**: **Phase 10.1.4**: raw_data 저장 문제 해결 - **0% 완료** ❌

#### **📊 조정된 진행상황**

- **Phase 10.1.1**: k6 MCP 서버 문제 해결 - **100% 완료** ✅
- **Phase 10.1.2**: Playwright MCP 서버 문제 해결 - **80% 완료** 🔄
- **Phase 10.1.3**: Playwright 기반 단위테스트 엔진 구축 - **60% 완료** 🔄
- **Phase 10.1.4**: raw_data 저장 문제 해결 - **0% 완료** ❌ (새로 추가)
- **백엔드 리팩토링**: **100% 완료** ✅
- **UI 컴포넌트 통합**: **100% 완료** ✅
- **전체 진행률**: Phase 10 기준 약 **45% 완료** (새로운 문제 추가로 감소)

### **2025-08-18: MCP 서버 작동 문제 및 배포 용량 문제 발견**

#### **🚨 발견된 주요 문제점**

**1. MCP 테스트 서버 작동 문제**
- ✅ **k6 MCP 서버**: 타임아웃 오류 해결 완료, 정상 작동 확인
- 🔄 **Playwright MCP 서버**: 연결 및 실행 로직에 문제 존재 (E2E 테스트 완료 처리 문제)
- ❌ **Lighthouse MCP 서버**: CLI 실행은 되지만 실제 테스트 실행 시 오류 발생
- ⚠️ **근본 원인**: Child Process + stdin/stdout 방식의 한계 및 프로세스 관리 문제

**2. 배포 시 용량 문제**
- ❌ **MCP 서버 디렉토리**: 각 서버별 의존성 및 빌드 파일로 인한 용량 증가
- ❌ **Node.js 의존성**: Lighthouse, Playwright 등 대용량 패키지들
- ❌ **Python 의존성**: k6 서버 관련 Python 패키지들
- ⚠️ **영향**: 클라우드 배포 시 용량 제한으로 인한 배포 실패 가능성

#### **🔧 문제 해결 방안**

**1. MCP 서버 작동 문제 해결 (Phase 10.1 우선)**
- ✅ **k6 MCP 서버**: 타임아웃 문제 해결 완료, 부하 테스트 정상 실행
- 🔄 **Playwright MCP 서버**: E2E 테스트 완료 처리 문제 해결 중
- ❌ **Lighthouse MCP 서버**: CLI 실행은 되지만 실제 테스트 실행 시 오류 발생
- ⚠️ **오류 처리**: MCP 서버 실패 시 자동으로 직접 실행 방식으로 폴백

**2. 배포 용량 최적화 (Phase 10.2 포함)**
- **의존성 정리**: 불필요한 패키지 및 빌드 파일 제거
- **MCP 서버 최적화**: 필수 기능만 포함한 경량화 버전 구현
- **배포 전략**: 개발용과 배포용 MCP 서버 분리

#### **🎯 즉시 해결해야 할 문제**

1. ✅ **k6 MCP 서버 타임아웃 문제**: 부하 테스트 실행을 위한 최우선 해결 과제 - **해결 완료**
2. 🔄 **Playwright MCP 서버 연결 문제**: 단위테스트 시스템 구현을 위한 필수 해결 과제 - **진행 중**
3. ❌ **배포 용량 문제**: 클라우드 배포 성공을 위한 최적화 필요
4. ❌ **Lighthouse MCP 서버 문제**: 핵심기능 구현 완료 후 해결 (8월 23일)

### **2025-08-18: k6 MCP 서버 문제 해결 완료 및 Playwright 설정 모드 구현**

#### **🔧 주요 작업 내용**

**1. k6 MCP 서버 문제 해결 완료 (Phase 10.1.1)**
- ✅ **타임아웃 문제 해결**: `executeCommand` 타임아웃을 30초에서 10분으로 증가
- ✅ **프로세스 관리 개선**: `onData`, `onErrorData`, `onError`, `onClose` 핸들러 최적화
- ✅ **출력 형식 표준화**: `{"result": "..."}` → `{"output": "..."}` 변경
- ✅ **인코딩 문제 해결**: Windows 환경에서 `cp949` 코드c 오류 해결
- ✅ **k6 스크립트 오류 수정**: `Rate` 메트릭 추가로 threshold 오류 해결
- ✅ **프론트엔드 실행 연결**: 기본 k6 스크립트 자동 생성으로 400(Bad Request) 제거 및 실행 성공 (백엔드 검증 필수 필드 충족)

**2. Playwright 설정 모드 2가지 버전 구현 (Phase 10.1.3 일부)**
- ✅ **항목별 설정 모드**: 기존의 상세한 설정 화면 (브라우저, 뷰포트, 타임아웃 등)
- ✅ **시나리오 입력 모드**: 사용자가 직접 Playwright 테스트 코드를 작성할 수 있는 화면
- ✅ **설정 모드 전환**: 탭 형태로 두 모드 간 자유로운 전환 가능
- ✅ **사용자 정의 시나리오**: `customScenario` 필드로 백엔드에 전달

**3. E2E 테스트 완료 처리 문제 해결 진행 중**
- 🔄 **테스트 완료 상태 모니터링**: `useEffect`를 통한 자동 감지 로직 구현
- 🔄 **상태 업데이트 개선**: 완료된 테스트를 실행 중 목록에서 자동 제거
- 🔄 **실행 현황 새로고침**: 테스트 완료 후 자동으로 결과 업데이트

#### **🎯 해결된 문제점**

1. ✅ **k6 MCP 서버 타임아웃 문제**: 부하 테스트 정상 실행 가능
2. ✅ **k6 출력 형식 문제**: `raw_data`에 올바른 k6 결과 저장
3. ✅ **Windows 인코딩 문제**: `cp949` 코드c 오류 해결
4. ✅ **Playwright 설정 모드**: 2가지 버전으로 사용자 경험 향상

#### **📊 현재 진행상황**

- **Phase 10.1.1**: k6 MCP 서버 문제 해결 - **100% 완료** ✅
- **Phase 10.1.2**: Playwright MCP 서버 문제 해결 - **60% 완료** 🔄
- **Phase 10.1.3**: Playwright 기반 단위테스트 엔진 구축 - **40% 완료** 🔄
- **전체 진행률**: Phase 10 기준 약 35% 완료

#### **🔍 다음 작업**

1. **Playwright MCP 서버 E2E 테스트 완료 처리 문제 해결** (Phase 10.1.2 완료)
2. **Playwright 기반 단위테스트 엔진 완성** (Phase 10.1.3 완료)
3. **테스트 설정 관리 페이지 구현** (Phase 10.2 시작)
4. **배포 용량 최적화** (Phase 10.2.4)

